<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Leave Page</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'images/icon.png' %}">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"> <!-- Font Awesome css -->

</head>
<style>
    body {
    background-color: #f4f9ff;
    color: #000;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
}

.sidebar {
    background-color: #0F1A60;
    color: white;
    width: 250px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 10%;
}

.sidebar a {
    color: white;
    padding: 13px;
    text-decoration: none;
    display: block;
    border-radius: 5px;
    margin-bottom: 10px;
    transition: background-color 0.3s;
    text-align: center;
    align-items: left;
}

.sidebar a:hover {
    background-color: #1f4068;
}

.sidebar a i {
    margin-right: 10px;
}

.sidebar .sign-out {
    margin-top: auto;
}

.container {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    flex-grow: 5;
    display: flex;
    flex-direction: column;
    margin: 10px auto; /* Adjusts vertical and horizontal margin */
    margin-left: 100px; /* Add custom left margin */
    width: 95%; /* Adjust width for responsiveness */
    max-width: 1200px; /* Limit maximum width for large screens */
}


.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.header h1 {
    font-size: 24px;
    margin: 0;
}

.user-info {
    display: flex;
    align-items: center;
}

.user-info img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
}

.statistics-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 15px;
    margin-bottom: 40px;
    width: 120%;
    height: 600px;

}
.statistics-item{
    background-color:  #e0e0e0;
    padding: 20px;
    border-radius: 10px;
    flex: 1 1 calc(33.33% - 10px); /* Flex for 3 columns */
    min-width: 150px;
    text-align: center;
    height: 600px;
}
.holiday-list {
    background-color:  #e0e0e0;
    padding: 20px;
    gap: 15px;
    border-radius: 10px;
    flex: 1 1 calc(33.33% - 10px); /* Flex for 3 columns */
    min-width: 150px;
    text-align: center;
    overflow-y: auto;
    border: 1px solid #ddd;
    padding: 10px;
    height: 600px;
}

.calendar {
    background-color:  #e0e0e0;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    flex: 1 1 calc(33.33% - 10px); /* Flex for 3 columns */
    min-width: 300px;
}

.leave-history {
    margin-top: 20px;
}

.leave-history table {
    width: 120%;
    border-collapse: collapse;
    margin: 20px auto;
    font-size: 16px;
}

.leave-history th,
.leave-history td {
    padding: 15px;
    border: 1px solid #e0e0e0;
    text-align: center;
}

.leave-history th {
    background-color: green;
}

.leave-history td i {
    cursor: pointer;
}

.leave-history td i:hover {
    color: #1f4068;
}

.apply-btn {
    display: inline-block;
    padding: 10px 20px;
    border-radius: 50px;
    background-color: #c1fff7ee;
    color: black;
    text-decoration: none;
    font-weight: bold;
    text-align: center;
    margin: 20px auto;
    transition: background-color 0.3s;
}

.apply-btn:hover {
    background-color: #00274D;
    color: white;
}

.calendar-container {
    background-color: #f9f9f9;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    margin: 20px auto;
    width: 100%;
    max-width: 550px; /* Limit width */
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.calendar-header h4 {
    margin: 0;
    font-size: 1.2rem;
}

.calendar-header button {
    background: none;
    border: none;
    color: #007bff;
    font-size: 20px;
    cursor: pointer;
}

.calendar-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    margin-bottom: 20px;
}

.calendar-days div {
    background-color: white;
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    cursor: pointer;
}

.calendar-days div:hover {
    background-color: #e0e0e0;
}

.calendar-days div.active {
    background-color: #1f4068;
    color: white;
}

.styled-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px auto;
    font-size: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.styled-table th,
.styled-table td {
    padding: 12px 15px;
    border: 1px solid #dddddd;

}

.styled-table thead tr {
    background-color: #009879;
    color: black;
}

.styled-table tbody tr:nth-child(even) {
    background-color: #f3f3f3;
}

.styled-table tbody tr:hover {
    background-color: #f1f1f1;
}

/* Hide the titles by default */
.sidebar-link .sidebar-title {
    display: none;
    position: absolute;
    left: 100%;
    top: 50%;
    transform: translateY(-50%);
    background-color: #1f4068;
    color: white;
    padding: 5px;
    white-space: nowrap;
    border-radius: 5px;
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
    z-index: 1000;
}

/* Show the titles when hovering over the button */
.sidebar-link:hover .sidebar-title {
    display: inline-block;
    opacity: 1;
    transform: translateY(-50%) translateX(10px);
}

.sidebar-link {
    position: relative;
    display: flex;
    align-items: center;
    padding: 5px 10px;
    text-decoration: none;
    color: white;
    transition: background-color 0.3s;
}

.sidebar-link:hover {
    background-color: #1f4068;
}

/* Responsive Adjustments */
@media screen and (max-width: 900px) {
    .statistics-container {
        flex-direction: column;
    }

    .statistics-item,
    .holiday-list,
    .calendar {
        flex: 1 1 200%;
        margin-bottom: 15px;
    }

    .sidebar {
        width: 100px;
    }

    .container {
        padding: 10px;
    }

    .leave-history table {
        font-size: 14px;
    }
}
    .holiday-item {
    margin-bottom: 10px;
    padding: 10px;
    list-style: none;
    border-radius: 5px;
    color: white;
}

.future-holiday {
    background-color: blue;
}

.past-holiday {
    background-color: grey;
}
.apply-btns{
    font-weight: bold;
}
</style>
<body style="text-transform: uppercase;">
<!--<div class="sidebar-toggle">-->
<!--    <i class="fas fa-bars"></i>-->
</div>
    <div class="sidebar">
          </br>
             <img src="{% static 'images/img_19.png' %}" alt="Responsive image" width="150" height="40">
            </br></br>
            {% if user.is_authenticated %}
            <h4 style="color: white; text-transform: uppercase; font-weight: bold;" align="center"><img  src="{% static 'images/R.png' %}" alt="User" style="width: 45px; height: 50px; border-radius: 16px;"></br>{{ user.username }} </h4><h6 align="center">{{ designation }}</h6>
        {% else %}
            <h4>Welcome, Guest!</h4>
        {% endif %}
</br></br></br>
<!--        <a href="{% url 'task_dashboard' %}" class="sidebar-link"><img src="{% static 'images/img_8.png' %}" width="40" height="40">&nbsp;&nbsp;<span class="sidebar-title">Dashboard</span></a>-->
        <a href="{% url 'calendar' %}" class="sidebar-link"><img src="{% static 'images/img_14.png' %}" width="40" height="40">&nbsp;&nbsp;<span class="sidebar-title">Attendance</span></a>
         <a href="{% url 'main_leave_page' %}" class="sidebar-link"><img src="{% static 'images/img_13.png' %}" width="40" height="40">&nbsp;&nbsp;<span class="sidebar-title"> LeavePage</span></a>
        <a href="{% url 'task_dashboard' %}" class="sidebar-link"><img src="{% static 'images/img_11.png' %}" width="40" height="40">&nbsp;&nbsp;<span class="sidebar-title"> ViewTasks</span></a>
        <a href="{% url 'logouts' %}" class="sign-out sidebar-link"><img src="{% static 'images/img_12.png' %}" width="40" height="40">&nbsp;&nbsp;<span class="sidebar-title"> SignOut</span></a>
    </div>
    <div class="container">
        <div class="statistics-container">
            <div class="statistics-item">
                <h4><strong>Leave Statistics for 2024</strong></h4><br>
                <p class="mt-2">{{ total_leave }} Balance Leave Available</p>
                <canvas id="leaveChart" ></canvas>
                <a style="text-decoration: none;" href="#" class="apply-btns">Know More about Company Leave Policy</a>
            </div>
            <div class="holiday-list">
    <h3><strong>Holidays of the Year</strong></h3>
<br>
<ul class="list-group">
    {% for holiday in holidays %}
        {% if holiday.name != "Saturday" %}
            {% if holiday.date|date:"Y-m-d" > today|date:"Y-m-d" %}
                <li class="holiday-item past-holiday">
            {% else %}
                <li class="holiday-item future-holiday">
            {% endif %}
                    <strong style="float: left;">{{ holiday.name }}</strong>
                    <span style="float: right;">{{ holiday.date|date:"M d, Y" }}</span>
                </li>
        {% endif %}
    {% empty %}
        <li class="holiday-item text-center">No holidays found.</li>
    {% endfor %}
</ul>
</div>
            <div class="calendar">
              </br></br>
    <div class="calendar-header">
        <button id="prevMonth">&lt;</button>
        <h4 id="calendarMonthYear"></h4>
        <button id="nextMonth">&gt;</button>
    </div>
    <div class="calendar-days" id="calendarDays">
        <!-- Days of the week -->
        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
    </div>
    <div class="calendar-footer">
         <a style="text-decoration: none;" href="{% url 'leave_application' %}" class="apply-btn"><i class="fas fa-calendar-alt"></i> Apply Leave</a>
    </div>
</div>
        </div>
        <div class="leave-history">
            <h4 align="center"><strong>Past Leave History</strong></h4>
    <table class="styled-table">
        <thead>
            <tr>
                <th>Leave Date</th>
                <th>Leave Type</th>
<!--                <th>Leave Option</th>-->
                <th>Requested On</th>
                <th>Approved By</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for leave_application in leave_applications %}
            <tr>
                <td>{{ leave_application.start_date }} <strong>TO</strong> {{ leave_application.end_date }} </br>{{ leave_application.leave_days }} </td>
                <td>
    {% if leave_application.leave_type == 'Full Day' %}
        <span style="color: #0040C9;">Full Day Leave</span>
    {% elif leave_application.leave_type == 'Half Day' %}
        <span style="color: #4D00B9;">Half Day Leave</span>
    {% elif leave_application.leave_type == 'WFH' %}
        <span style="color: #00BC29;">Work From Home</span>
    {% else %}
        <span style="color: black;">{{ leave_application.leave_type }}</span>
    {% endif %}
</td>
<!--                <td>{{ leave_application.leave_option }}</td>-->
                <td>{{ leave_application.created_at|date:"M d, Y H:i" }}</td>
<!--                <td>{{ leave_application.updated_at|date:"M d, Y H:i" }}</td>-->
                <td>{{ leave_application.approver }}</td>
                <td>
                    {% if leave_application.is_approved %}
                    <span style="color: green;">Approved</span>
                    {% else %}
                    <span style="color: red;">Pending</span>
                    {% endif %}
                </td>
                <td>
    <!-- Edit action with anchor tag linking to the edit page -->
    <a href="{% url 'edit_leave_application' leave_application.pk %}" title="Edit"><img src="{% static 'images/img_5.png' %}" width="25" height="25"></a>
&emsp;
    <!-- Delete action with anchor tag and onclick event for confirmation -->
    <a href="#" class="fas fa-trash-alt" title="Delete" onclick="confirmDelete('{{ leave_application.pk }}')"></a>
&emsp;
    <!-- Hidden form for deletion, submitted via JavaScript when confirmed -->
 <form id="delete-form-{{ leave_application.pk }}" action="{% url 'delete_leave_application' leave_application.pk %}" method="post" style="display: none;">
        {% csrf_token %}
    </form>
    <!-- Comment icon -->
    <i class="fas fa-comment" title="Comment"></i>
</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No leave applications found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

    </div>
    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <script>
        const calendarDays = document.getElementById('calendarDays');
    const calendarMonthYear = document.getElementById('calendarMonthYear');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');

    let currentDate = new Date();

    // Function to render calendar
    function renderCalendar(date) {
        // Clear the previous content
        calendarDays.innerHTML = '<div>Sun</div><div>MoN</div><div>TuE</div><div>WeD</div><div>ThU</div><div>FrI</div><div>SaT</div>';

        // Get the current month and year
        const year = date.getFullYear();
        const month = date.getMonth();

        // Get the first day of the month
        const firstDay = new Date(year, month, 1).getDay();
        // Get the total days in the month
        const totalDays = new Date(year, month + 1, 0).getDate();

        // Set the calendar month and year in the header
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        calendarMonthYear.innerText = `${monthNames[month]} ${year}`;

        // Add blank divs for days of the previous month
        for (let i = 0; i < firstDay; i++) {
            const blankDiv = document.createElement('div');
            blankDiv.classList.add('blank');
            calendarDays.appendChild(blankDiv);
        }
        // Add days of the current month
        for (let day = 1; day <= totalDays; day++) {
            const dayDiv = document.createElement('div');
            dayDiv.textContent = day;

            // Highlight current day
            if (day === date.getDate() && year === new Date().getFullYear() && month === new Date().getMonth()) {
                dayDiv.classList.add('active');
            }
            calendarDays.appendChild(dayDiv);
        }
    }
    // Event listeners for month navigation
    prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
    });
    nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
    });
    // Initial render for the current month
    renderCalendar(currentDate);

        function confirmDelete(pk) {
            if (confirm('Are you sure you want to delete this leave application?')) {
                document.getElementById('delete-form-' + pk).submit();
            }
        }
        const ctx = document.getElementById('leaveChart').getContext('2d');
        const leaveChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Full Days', 'Half Days', 'WFH', 'Balance Leave', 'Comp Leave'],
                datasets: [{
                    data: [{{ full_day_leaves }}, {{ half_day_leaves }}, {{ wfh_leaves }}, {{ balance_leave }}, {{ compensation_leaves }}],
                   backgroundColor: [
    '#0F1A60',  // Base Color - Deep Blue-Violet
    '#142F91',  // Darker Blue-Violet
    '#274BB3',  // Medium Blue-Violet
    '#5A77D1',  // Light Blue-Violet
    '#9BB2F0'   // Very Light Blue-Violet
],
borderColor: [
    '#0F1A60',  // Base Color - Deep Blue-Violet
    '#142F91',  // Darker Blue-Violet
    '#274BB3',  // Medium Blue-Violet
    '#5A77D1',  // Light Blue-Violet
    '#9BB2F0'   // Very Light Blue-Violet
],

                    borderWidth: 5
                }]
            },
            options: {
                responsive: true,
                cutout: '50%', // For doughnut chart inner cutout
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: 'black',
                            font: {
                                size: 18
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context. label || '';
                                const value = context. raw || 0;
                                return `${label}: ${value}`;
                            }
                        }
                    }
                }
            }
        });
        document.addEventListener("DOMContentLoaded", function() {
        const sidebarToggle = document.querySelector(".sidebar-toggle");
        const sidebar = document.querySelector(".sidebar");
        sidebarToggle.addEventListener("click", function() {
            sidebar.classList.toggle("show");
        });
    });
    </script>
</body>
</html>
